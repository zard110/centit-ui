<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Centit-UI 开发文档</title>
</head>
<body>
<div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="8xyt" id="centit-ui-开发文档">Centit-UI 开发文档</h1><hr><p data-anchor-id="pldx">在正式介绍如何开发一个新页面之前，需要强调的是：<strong>不要使用 iframe！！！</strong> <strong>不要直接在页面上写业务 javascript！！！</strong>这些都是以前项目的开发习惯，虽然编码时快速方便，但是在代码的重用性、维护性上存在严重的问题。</p><p data-anchor-id="mgge">当然你也不用担心，虽然不能用iframe、不能直接写javascript，但是通过新的模块化机制以及组件的继承，以前的所有功能都可以实现，而且会更加简单。这也正是我们追求的目标：<em>在代码维护性和上手难度之间找到一个平衡点</em></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="73o2" id="1第一个页面atm自动存取款机">1、第一个页面：ATM自动存取款机</h2><p data-anchor-id="b55h">这里我们不准备讨论细节，只关注流程。ATM的功能很简单：可以显示列表、存款、取款和查看明细。 <br>
<img src="img/atm.gif" alt="ATM自动存取款机示意图" title=""> </p><hr><div class="md-section-divider"></div><h2 data-anchor-id="wx7h" id="2文件结构">2、文件结构</h2><pre data-anchor-id="gfkh"><code>/webapp
|----/modules
     |----/atm
          |----atm.jsp                  // 列表页面
          |----atm-save.jsp             // 存款页面
          |----atm-get.jsp              // 取款页面
          |----atm-detail.jsp           // 操作详情页面
          |----/ctrl
               |----atm.js              // 列表控制器
               |----atm.save.js         // 存款控制器
               |----atm.get.js          // 取款控制器
               |----atm.detail.js       // 详情控制器
</code></pre><hr><div class="md-section-divider"></div><h2 data-anchor-id="k8vi" id="3列表">3、列表</h2><p data-anchor-id="1k7r">列表页面包含工具栏和数据表格，<strong>atm.jsp</strong>内容如下</p><div class="md-section-divider"></div><h3 data-anchor-id="xhvq" id="①-表格">① 表格</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="04g2"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;table</span><span class="pln"> </span><span class="atn">url</span><span class="pun">=</span><span class="atv">"${ctx}/modules/core/crud/data/list.json"</span></code></li><li class="L1"><code><span class="pln">        </span><span class="atn">layoutH</span><span class="pun">=</span><span class="atv">"0"</span></code></li><li class="L2"><code><span class="pln">        </span><span class="atn">toolbar</span><span class="pun">=</span><span class="atv">".temp-toolbar"</span></code></li><li class="L3"><code><span class="pln">        </span><span class="atn">height</span><span class="pun">=</span><span class="atv">"500"</span><span class="tag">&gt;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="tag">&lt;thead&gt;</span></code></li><li class="L5"><code><span class="pln">        </span><span class="tag">&lt;tr&gt;</span></code></li><li class="L6"><code><span class="pln">            </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">field</span><span class="pun">=</span><span class="atv">"id"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"150"</span><span class="pln"> </span><span class="atn">align</span><span class="pun">=</span><span class="atv">"center"</span><span class="tag">&gt;</span><span class="pln">流水号</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L7"><code><span class="pln">            </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">field</span><span class="pun">=</span><span class="atv">"operator"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"100"</span><span class="pln"> </span><span class="atn">align</span><span class="pun">=</span><span class="atv">"center"</span><span class="tag">&gt;</span><span class="pln">操作</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L8"><code><span class="pln">            </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">field</span><span class="pun">=</span><span class="atv">"money"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"150"</span><span class="pln"> </span><span class="atn">align</span><span class="pun">=</span><span class="atv">"right"</span><span class="tag">&gt;</span><span class="pln">金额</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L9"><code><span class="pln">            </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">field</span><span class="pun">=</span><span class="atv">"balance"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"150"</span><span class="pln"> </span><span class="atn">align</span><span class="pun">=</span><span class="atv">"right"</span><span class="tag">&gt;</span><span class="pln">余额</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L0"><code><span class="pln">            </span><span class="tag">&lt;th</span><span class="pln"> </span><span class="atn">field</span><span class="pun">=</span><span class="atv">"date"</span><span class="pln"> </span><span class="atn">width</span><span class="pun">=</span><span class="atv">"250"</span><span class="atn">align</span><span class="pun">=</span><span class="atv">"center"</span><span class="tag">&gt;</span><span class="pln">日期</span><span class="tag">&lt;/th&gt;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="tag">&lt;/tr&gt;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="tag">&lt;/thead&gt;</span></code></li><li class="L3"><code><span class="tag">&lt;/table&gt;</span></code></li></ol></pre><p data-anchor-id="2q96">我们现在只关注table中的<em>url</em> 属性，表格中的数据是通过ajax请求url地址，得到数据如下格式：</p><div class="md-section-divider"></div><h3 data-anchor-id="eb2i" id="②表格数据">②表格数据</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4hs2"><ol class="linenums"><li class="L0"><code><span class="pun">[</span></code></li><li class="L1"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1000000000000"</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">    </span><span class="str">"balance"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1000</span></code></li><li class="L4"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pun">]</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="8kag" id="③工具栏">③工具栏</h3><p data-anchor-id="kldm">通过table的<em>toolbar</em> 属性，表格和工具栏得以联系在一起</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="mn0s"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"temp-toolbar"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"save"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"modules/core/crud/crud-save.html"</span><span class="pln"> </span><span class="atn">iconCls</span><span class="pun">=</span><span class="atv">"icon-base icon-base-take_in"</span></code></li><li class="L2"><code><span class="pln">       </span><span class="atn">trigger</span><span class="pun">=</span><span class="atv">"none"</span><span class="pln"> </span><span class="atn">target</span><span class="pun">=</span><span class="atv">"dialog"</span><span class="tag">&gt;</span><span class="pln">存款</span><span class="tag">&lt;/a&gt;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"get"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"modules/core/crud/crud-get.html"</span><span class="pln"> </span><span class="atn">iconCls</span><span class="pun">=</span><span class="atv">"icon-base icon-base-take_out"</span></code></li><li class="L4"><code><span class="pln">       </span><span class="atn">trigger</span><span class="pun">=</span><span class="atv">"none"</span><span class="pln"> </span><span class="atn">target</span><span class="pun">=</span><span class="atv">"dialog"</span><span class="tag">&gt;</span><span class="pln">取款</span><span class="tag">&lt;/a&gt;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="tag">&lt;hr&gt;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">rel</span><span class="pun">=</span><span class="atv">"detail"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"modules/core/crud/crud-detail.html"</span><span class="pln"> </span><span class="atn">iconCls</span><span class="pun">=</span><span class="atv">"icon-base icon-base-info"</span></code></li><li class="L7"><code><span class="pln">       </span><span class="atn">trigger</span><span class="pun">=</span><span class="atv">"single"</span><span class="pln"> </span><span class="atn">target</span><span class="pun">=</span><span class="atv">"dialog"</span><span class="pln"> </span><span class="atn">title</span><span class="pun">=</span><span class="atv">"操作明细"</span><span class="tag">&gt;</span><span class="pln">明细</span><span class="tag">&lt;/a&gt;</span></code></li><li class="L8"><code><span class="tag">&lt;/div&gt;</span></code></li></ol></pre><p data-anchor-id="ix13">在这个例子中有3个按钮，对应3种操作：存款、取款、查看明细。<strong>特别注意</strong> <em>rel</em>  属性，唯一不重复控制器的id。而点击按钮后的逻辑，将写在各自的控制器中。</p><div class="md-section-divider"></div><h3 data-anchor-id="d59z" id="④加载控制器">④加载控制器</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ilcg"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;script&gt;</span></code></li><li class="L1"><code><span class="pln">    $</span><span class="pun">.</span><span class="pln">parser</span><span class="pun">.</span><span class="pln">onComplete </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">panel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        $</span><span class="pun">.</span><span class="pln">parser</span><span class="pun">.</span><span class="pln">onComplete </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">noop</span><span class="pun">;</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">        requirejs</span><span class="pun">([</span></code></li><li class="L5"><code><span class="pln">            </span><span class="str">'modules/atm/ctrl/atm'</span></code></li><li class="L6"><code><span class="pln">        </span><span class="pun">],</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">ATM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">            </span><span class="kwd">new</span><span class="pln"> ATM</span><span class="pun">(</span><span class="str">'ATM'</span><span class="pun">,</span><span class="pln"> panel</span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln">panel</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">};</span></code></li><li class="L0"><code><span class="tag">&lt;/script&gt;</span></code></li></ol></pre><p data-anchor-id="k6h1"><strong>$.parser.onComplete</strong> 确保在页面加载完毕，并且所有<em>easyUI</em> 组件渲染完毕后会自动调用。</p><p data-anchor-id="eibf">里面是标准的模块化调用写法，现在我们只需要知道页面会加载 <em>atm.js</em>，有关列表的所有业务逻辑都会写在 <em>atm.js</em> 里。</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="hr8o" id="4列表控制器">4、列表控制器</h2><p data-anchor-id="ne6r">让我们一起来看看列表控制器 <em>atm.js</em> 里都写了什么</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="dw5d"><ol class="linenums"><li class="L0"><code><span class="pln">define</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">require</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'plugins/extend'</span><span class="pun">);</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="com">// 页面基础对象，提供了对页面的控制方法</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'core/page'</span><span class="pun">);</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="com">// 存款控制器</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../ctrl/crud.save'</span><span class="pun">);</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">    </span><span class="com">// 取款控制器</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">GetCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../ctrl/crud.get'</span><span class="pun">);</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 查看详情控制器</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">DetailCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../ctrl/crud.detail'</span><span class="pun">);</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 通过扩展的方式定义列表页面的处理方法</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> ATM </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Page</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">        </span><span class="com">// 注入存款、取款、查看详情3个子控制器</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">injecte</span><span class="pun">([</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pun">(</span><span class="str">'save'</span><span class="pun">),</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GetCtrl</span><span class="pun">(</span><span class="str">'get'</span><span class="pun">),</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DetailCtrl</span><span class="pun">(</span><span class="str">'detail'</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">]);</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">        </span><span class="com">// 重写 Page 类中页面加载调用方法</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">load </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">panel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">            </span><span class="com">// 保存页面一些值，比如：余额</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">balance </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">;</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">            </span><span class="com">// 去id化查找表格，去id化可以更好滴移植、继承控制器</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> table </span><span class="pun">=</span><span class="pln"> panel</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">'table'</span><span class="pun">);</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">            </span><span class="com">// 执行表格插件</span></code></li><li class="L5"><code><span class="pln">            table</span><span class="pun">.</span><span class="pln">cdatagrid</span><span class="pun">({</span></code></li><li class="L6"><code><span class="pln">                controller</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> ATM</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="qrru">去掉注释和变量定以后其实没有几行代码。</p><p data-anchor-id="63n1">我们将页面行为总结为2点：① 加载，比如初始化页面等，② 提交，比如提交表单。</p><p data-anchor-id="nuwq">所有的行为几乎都可以归结为以上2个步骤。在<em>Page</em> 类中定义了默认的 <em>load</em> 和 <em>submit</em> 方法，在业务类中需要继承并重写这些方法。</p><p data-anchor-id="h67o"><strong>特别注意</strong>的是，控制器中注入了3个子控制器，通过 id 将页面按钮和控制器联系到了一起。</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="cqk2" id="5存款页面">5、存款页面</h2><p data-anchor-id="q5xo">存款页面是 <em>atm-save.html</em> </p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="nfi6"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;form</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"form centit"</span><span class="tag">&gt;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"field required"</span><span class="tag">&gt;</span></code></li><li class="L2"><code><span class="pln">        </span><span class="tag">&lt;label&gt;</span><span class="pln">存款</span><span class="tag">&lt;/label&gt;</span></code></li><li class="L3"><code><span class="pln">        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"easyui-numberbox"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"money"</span></code></li><li class="L4"><code><span class="pln">               </span><span class="atn">min</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">prefix</span><span class="pun">=</span><span class="atv">"￥"</span></code></li><li class="L5"><code><span class="pln">                </span><span class="atn">required</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="tag">&lt;/div&gt;</span></code></li><li class="L7"><code><span class="tag">&lt;/form&gt;</span></code></li></ol></pre><p data-anchor-id="hp2l">是的，我们只需要定义代码片段，不用再写完整的 html 、head 、body 等等，很方便吧~</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="e2ts" id="6存款页面控制器">6、存款页面控制器</h2><p data-anchor-id="cj2a">存款页面控制器 <em>atm.save.js</em> 已经在列表页面控制器中注入，所以不需要再在页面上引用</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="c2oq"><ol class="linenums"><li class="L0"><code><span class="pln">define</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">require</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'plugins/extend'</span><span class="pun">);</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> $ </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'jquery'</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'core/page'</span><span class="pun">);</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Page</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">        </span><span class="com">// 重写页面加载方法</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">load </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">panel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> form </span><span class="pun">=</span><span class="pln"> panel</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">'form'</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">            form</span><span class="pun">.</span><span class="pln">form</span><span class="pun">(</span><span class="str">'disableValidation'</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">form</span><span class="pun">(</span><span class="str">'focus'</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">        </span><span class="com">// 重写页面提交方法</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">submit </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">panel</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> closeCallback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> form </span><span class="pun">=</span><span class="pln"> panel</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="str">'form'</span><span class="pun">);</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">            form</span><span class="pun">.</span><span class="pln">form</span><span class="pun">(</span><span class="str">'enableValidation'</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> isValid </span><span class="pun">=</span><span class="pln"> form</span><span class="pun">.</span><span class="pln">form</span><span class="pun">(</span><span class="str">'validate'</span><span class="pun">);</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isValid</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">                </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">                    money</span><span class="pun">:</span><span class="pln"> parseInt</span><span class="pun">(</span><span class="pln">form</span><span class="pun">.</span><span class="pln">form</span><span class="pun">(</span><span class="str">'value'</span><span class="pun">).</span><span class="pln">money</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">                </span><span class="pun">}</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">                </span><span class="com">// 关闭窗口</span></code></li><li class="L0"><code><span class="pln">                closeCallback</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">        </span><span class="com">// 重写页面关闭调用方法</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">onClose </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">table</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">                </span><span class="com">// 通过 parent 调用父控制器的一些值</span></code></li><li class="L1"><code><span class="pln">                </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">parent</span><span class="pun">.</span><span class="pln">balance </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">money</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">                </span><span class="com">// 插入数据</span></code></li><li class="L4"><code><span class="pln">                table</span><span class="pun">.</span><span class="pln">datagrid</span><span class="pun">(</span><span class="str">'appendRow'</span><span class="pun">,</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">                    id</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">().</span><span class="pln">getTime</span><span class="pun">(),</span></code></li><li class="L6"><code><span class="pln">                    </span><span class="kwd">operator</span><span class="pun">:</span><span class="pln"> </span><span class="str">'存款'</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">                    balance</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">parent</span><span class="pun">.</span><span class="pln">balance</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">                    date</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span></code></li><li class="L9"><code><span class="pln">                </span><span class="pun">}));</span></code></li><li class="L0"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pun">});</span></code></li></ol></pre><hr><div class="md-section-divider"></div><h2 data-anchor-id="2zlh" id="7使用对象扩展方式的好处">7、使用对象扩展方式的好处</h2><p data-anchor-id="i54j">取款控制器与存款控制器之间有很多相似的地方，只是最后提交时逻辑有所不同（一个是加余额，另一个是减余额），所以可以直接扩展存款控制器，重写不同的地方即可</p><p data-anchor-id="4mj8"><em>atm.get.js</em></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="5i8s"><ol class="linenums"><li class="L0"><code><span class="pln">define</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">require</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'plugins/extend'</span><span class="pun">);</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> $ </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'jquery'</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./crud.save'</span><span class="pun">);</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> </span><span class="typ">GetCtrl</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SaveCtrl</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">onClose </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">table</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">                </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">parent</span><span class="pun">.</span><span class="pln">balance </span><span class="pun">-=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">money</span><span class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">                table</span><span class="pun">.</span><span class="pln">datagrid</span><span class="pun">(</span><span class="str">'appendRow'</span><span class="pun">,</span><span class="pln"> $</span><span class="pun">.</span><span class="pln">extend</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">                    id</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">().</span><span class="pln">getTime</span><span class="pun">(),</span></code></li><li class="L5"><code><span class="pln">                    </span><span class="kwd">operator</span><span class="pun">:</span><span class="pln"> </span><span class="str">'取款'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">                    balance</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">parent</span><span class="pun">.</span><span class="pln">balance</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">                    date</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">}));</span></code></li><li class="L9"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">GetCtrl</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="4bg1">在具体项目中，通过对业务的整理归纳，可以写出重用率很好的业务特有控制模块。</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="r3hw" id="8总结">8、总结</h2><p data-anchor-id="xypd">通过上面的列子，我们已经大概了解页面的开发流程。上面所有代码都可以在<a href="https://192.168.128.8/svn/centit/framework/framework-ui/src/main/webapp/modules/core/crud/" target="_blank">SVN</a>中获得</p>
</body>
</html>